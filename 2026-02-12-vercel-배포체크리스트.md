# Vercel ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ - Magic Link ì¸ì¦

**ë¸Œëœì¹˜:** `feat/login-magic-link`  
**PR:** https://github.com/vobcodee/simple-note/pull/new/feat/login-magic-link  

---

## âš ï¸ ë°°í¬ ì „ í•„ìˆ˜ í™•ì¸ì‚¬í•­

### 1. Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© (í•„ìˆ˜)

**ë¨¼ì € Dashboardì—ì„œ SQL ì‹¤í–‰:**

#### 003_add_user_id_to_notes.sql
```sql
-- Add user_id column to notes table for authentication
alter table public.notes
add column if not exists user_id uuid references auth.users(id) on delete cascade;

create index if not exists notes_user_id_idx
on public.notes (user_id);

comment on column public.notes.user_id is 'Reference to the auth.users table';
```

#### 004_update_rls_policies_auth.sql
```sql
drop policy if exists "Enable read for all" on public.notes;
drop policy if exists "Enable insert for all" on public.notes;
drop policy if exists "Enable update for all" on public.notes;
drop policy if exists "Enable delete for all" on public.notes;

create policy "Users can read own notes"
on public.notes for select
using (auth.uid() = user_id);

create policy "Users can insert own notes"
on public.notes for insert
with check (auth.uid() = user_id);

create policy "Users can update own notes"
on public.notes for update
using (auth.uid() = user_id)
with check (auth.uid() = user_id);

create policy "Users can delete own notes"
on public.notes for delete
using (auth.uid() = user_id);
```

---

### 2. Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (í•„ìˆ˜)

**Vercel Dashboard â†’ Project â†’ Settings â†’ Environment Variables**

| ë³€ìˆ˜ëª… | ê°’ | ì„¤ëª… |
|--------|-----|------|
| `NEXT_PUBLIC_SUPABASE_URL` | `https://your-project.supabase.co` | Supabase í”„ë¡œì íŠ¸ URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | `eyJhbG...` | public anon key |
| `SUPABASE_URL` | `https://your-project.supabase.co` | ì„œë²„ìš© URL (ë™ì¼) |
| `SUPABASE_SERVICE_ROLE_KEY` | `eyJhbG...` | service_role key (âš ï¸ ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€) |

**ì°¾ëŠ” ë°©ë²•:**
- Supabase Dashboard â†’ Project Settings â†’ API
- `anon public` â†’ NEXT_PUBLIC_SUPABASE_ANON_KEY
- `service_role secret` â†’ SUPABASE_SERVICE_ROLE_KEY (âš ï¸)

---

### 3. Supabase ì¸ì¦ ì„¤ì • (í•„ìˆ˜)

**Supabase Dashboard â†’ Authentication â†’ Providers â†’ Email**

- âœ… **Enable Email provider**
- â¬œ Confirm email (ê¶Œì¥: ë¹„í™œì„±í™” - ê°œë°œ í¸ì˜)
- âœ… Enable Signup

**Site URL ì„¤ì •:**
- **Production URL:** `https://your-app.vercel.app`
- **Redirect URLs:** 
  - `https://your-app.vercel.app/auth/callback`
  - `http://localhost:3000/auth/callback` (ê°œë°œìš©)

---

### 4. ê¸°ì¡´ ë°ì´í„° ì²˜ë¦¬ (ì£¼ì˜)

**ê¸°ì¡´ notes í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ user_idê°€ NULLì´ë¼ ì¡°íšŒ ë¶ˆê°€:**

**ì˜µì…˜ A - ë°ì´í„° ì´ˆê¸°í™” (ê¶Œì¥):**
```sql
TRUNCATE public.notes;
```

**ì˜µì…˜ B - ì„ì‹œ ì‚¬ìš©ì í• ë‹¹:**
```sql
UPDATE public.notes 
SET user_id = '00000000-0000-0000-0000-000000000000' 
WHERE user_id IS NULL;
```

---

## ğŸš€ ë°°í¬ ì ˆì°¨

### Step 1: PR ìƒì„± ë° ë¨¸ì§€
1. GitHubì—ì„œ PR ìƒì„±: `feat/login-magic-link` â†’ `main`
2. Vercel Preview ë°°í¬ í™•ì¸
3. í…ŒìŠ¤íŠ¸ ì§„í–‰ (ì•„ë˜ ì°¸ê³ )
4. ë¨¸ì§€ â†’ ìë™ Production ë°°í¬

### Step 2: ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] `/login` í˜ì´ì§€ ì •ìƒ í‘œì‹œ
- [ ] ì´ë©”ì¼ ì…ë ¥ â†’ "ë¡œê·¸ì¸ ë§í¬ ë°›ê¸°" í´ë¦­
- [ ] ì´ë©”ì¼ ìˆ˜ì‹  í™•ì¸ (ìŠ¤íŒ¸í•¨ë„ ì²´í¬)
- [ ] ì´ë©”ì¼ì˜ ë§í¬ í´ë¦­ â†’ `/notes`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ë¡œê·¸ì¸ ìƒíƒœì—ì„œ `/login` ì ‘ì† â†’ `/notes`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ë¡œê·¸ì•„ì›ƒ í´ë¦­ â†’ `/login`ìœ¼ë¡œ ì´ë™
- [ ] ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ `/notes` ì ‘ì† â†’ `/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ë…¸íŠ¸ CRUD ì‘ì—… ì •ìƒ ë™ì‘

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### "Failed to fetch" ë˜ëŠ” API ì˜¤ë¥˜
- í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½ í™•ì¸
- Supabase URL ì •í™•í•œì§€ í™•ì¸

### "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤" ì˜¤ë¥˜
- SUPABASE_SERVICE_ROLE_KEY í™•ì¸
- ë§ˆì´ê·¸ë ˆì´ì…˜ 003, 004 ì ìš© í™•ì¸

### ë¡œê·¸ì¸ ë§í¬ ì´ë©”ì¼ ë¯¸ìˆ˜ì‹ 
- ìŠ¤íŒ¸í•¨ í™•ì¸
- Supabase Dashboard â†’ Auth â†’ Email Templates í™•ì¸
- SMTP ì„¤ì • (SendGrid ë“± ì—°ë™ ê¶Œì¥)

### 500 Internal Server Error
- Vercel Functions ë¡œê·¸ í™•ì¸
- í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½ ì—¬ë¶€ í™•ì¸

---

## ğŸ“‹ ì™„ë£Œ í›„ Phase 3 ì§„í–‰

Magic Link ì¸ì¦ ë°°í¬ ì™„ë£Œ í›„:
- [[2026-02-12-simple-note-ê°œì„ ê³„íš|Phase 3 ê°œì„  ì‘ì—…]] ì‹œì‘
- Zod ëŸ°íƒ€ì„ ê²€ì¦ ê°•í™”
- Error Boundary êµ¬í˜„
- SWR ë„ì…
